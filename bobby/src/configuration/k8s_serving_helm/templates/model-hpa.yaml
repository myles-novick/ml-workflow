{{ if eq .Values.autoscaling.enabled "true" }}
apiVersion: autoscaling/v1
kind: HorizontalPodAutoscaler
metadata:
  name: {{ template "kdeploy.identifier" . }}
  namespace: {{ .Values.k8s.namespace }}
  labels:
    identifier: {{ template "kdeploy.identifier" . }}
{{ include "kdeploy.ownerRef" . | indent 2 }}
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: model-{{ .Values.model.runId }}
  minReplicas: {{ .Values.baseReplicas }}
  maxReplicas: {{ .Values.autoscaling.maxReplicas }}
  targetCPUUtilizationPercentage: {{ .Values.autoscaling.targetCPULoad }}
{{ end }}
